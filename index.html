<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Icon Library - GUI Test</title>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "platform-icon-library": "https://unpkg.com/platform-icon-library@1.0.0/dist/index.mjs",
            "lucide-react": "https://esm.sh/lucide-react@0.268.0"
        }
    }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom colors for shadcn style */
      :root {
        --background: #fff;
        --primary: #2674be;
        --border: #e0e0e0;
        --muted-foreground: #888;
      }
      .bg-background { background-color: var(--background); }
      .text-primary { color: var(--primary); }
      .border-border { border-color: var(--border); }
      .text-muted-foreground { color: var(--muted-foreground); }
    </style>
</head>
<body class="bg-gray-50 flex justify-center p-2 sm:p-8 min-h-screen">
    <div id="root" class="w-full max-w-full sm:max-w-[1440px] bg-background rounded-xl shadow border border-border px-3 sm:px-8 py-6"></div>

    <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useMemo } from 'react';
    import ReactDOM from 'react-dom/client';
    import * as Icons from 'platform-icon-library';
    import { Copy, Check, Search } from 'lucide-react';

    function groupIconsByType(iconNames) {
        const groups = {};
        iconNames.forEach(name => {
            const words = name.match(/[A-Z][a-z0-9]*/g) || [name];
            const firstWord = words[0] || name;
            let mode = 'Other';
            if (/Light/i.test(name)) mode = 'Light';
            else if (/Dark/i.test(name)) mode = 'Dark';
            if (!groups[firstWord]) {
                groups[firstWord] = { Light: [], Dark: [], Other: [] };
            }
            groups[firstWord][mode].push(name);
        });
        return groups;
    }

    const iconNames = Object.keys(Icons);
    const grouped = groupIconsByType(iconNames);

    function App() {
        const [copiedName, setCopiedName] = useState('');
        const [searchTerm, setSearchTerm] = useState('');
        const [currentPage, setCurrentPage] = useState(1);
        const itemsPerPage = 30;

        const cdnUrl = "https://unpkg.com/platform-icon-library@1.0.0/dist/index.mjs";
        const [copiedCdn, setCopiedCdn] = useState(false);

        const handleCopy = (iconName) => {
            navigator.clipboard.writeText(iconName);
            setCopiedName(iconName);
            setTimeout(() => setCopiedName(''), 1000);
        };

        const handleCopyCdn = () => {
            navigator.clipboard.writeText(cdnUrl);
            setCopiedCdn(true);
            setTimeout(() => setCopiedCdn(false), 1000);
        };

        useEffect(() => {
            setCurrentPage(1);
        }, [searchTerm]);

        const flattenedIcons = useMemo(() => {
            const lowerSearch = searchTerm.toLowerCase();
            const list = [];
            Object.entries(grouped).forEach(([group, subgroups]) => {
                ['Light', 'Dark', 'Other'].forEach(mode => {
                    subgroups[mode].forEach(name => {
                        if (name.toLowerCase().includes(lowerSearch)) {
                            const Icon = Icons[name];
                            list.push({ group, mode, name, Icon });
                        }
                    });
                });
            });
            return list;
        }, [searchTerm]);

        const totalPages = Math.ceil(flattenedIcons.length / itemsPerPage);
        const currentPageItems = flattenedIcons.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);

        const pagedGrouped = useMemo(() => {
            const result = {};
            currentPageItems.forEach(({ group, mode, name, Icon }) => {
                if (!result[group]) result[group] = { Light: [], Dark: [], Other: [] };
                result[group][mode].push({ name, Icon });
            });
            return result;
        }, [currentPageItems]);

        const hasResults = flattenedIcons.length > 0;

        return (
            <div>
                <div
                    className="mb-6 flex flex-col sm:flex-row sm:items-center gap-2 bg-blue-50 border border-blue-200 rounded-md p-3 cursor-pointer select-none max-w-full"
                    onClick={handleCopyCdn}
                    role="button"
                    tabIndex={0}
                    onKeyDown={e => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            handleCopyCdn();
                        }
                    }}
                    aria-label="CDN import URL 복사"
                >
                    <input
                        type="text"
                        readOnly
                        value={cdnUrl}
                        className="flex-grow bg-blue-50 border border-blue-200 rounded-md px-3 py-1 text-sm text-blue-900 font-mono truncate cursor-pointer"
                        aria-readonly="true"
                        tabIndex={-1}
                    />
                    <button
                        type="button"
                        onClick={e => {
                            e.stopPropagation();
                            handleCopyCdn();
                        }}
                        className="flex-shrink-0 p-1"
                        aria-label="CDN URL 복사"
                    >
                        {copiedCdn ? <Check size={16} className="text-green-600" /> : <Copy size={16} className="text-blue-600" />}
                    </button>
                </div>

                <h1 className="text-2xl font-semibold text-primary border-b border-border pb-2 mb-6 select-none">BlackVue/FLEETA 아이콘 라이브러리</h1>

                <form className="flex justify-center mb-6 gap-2" onSubmit={e => e.preventDefault()}>
                    <input
                        type="search"
                        className="input input-md w-72"
                        placeholder="아이콘 이름 검색"
                        value={searchTerm}
                        onChange={e => setSearchTerm(e.target.value)}
                        aria-label="아이콘 이름 검색"
                        autoComplete="off"
                    />
                    <button type="submit" className="btn btn-square btn-outline" aria-label="검색 아이콘">
                        <Search size={20} />
                    </button>
                </form>

                <div>
                    {hasResults ? (
                        Object.entries(pagedGrouped).map(([group, subgroups]) => (
                            <section key={group} className="mb-8">
                                <h2 className="text-lg font-medium text-primary border-b border-border pb-1 mb-2 select-none">{group}</h2>
                                {['Light', 'Dark', 'Other'].map(mode =>
                                    subgroups[mode].length > 0 ? (
                                        <div key={mode} className="mb-4">
                                            <h3 className="text-sm text-muted-foreground mb-1 select-none">
                                                {mode === 'Light' && 'Light 모드'}
                                                {mode === 'Dark' && 'Dark 모드'}
                                                {mode === 'Other' && '기타'}
                                            </h3>
                                            <ul
                                                className="
                                                    grid
                                                    grid-cols-1
                                                    sm:grid-cols-2
                                                    lg:grid-cols-3
                                                    gap-3
                                                    mb-0
                                                    p-0
                                                    list-none
                                                    min-w-0 max-w-full overflow-hidden
                                                "
                                            >
                                                {subgroups[mode].map(({ name, Icon }) => (
                                                    <li
                                                        key={name}
                                                        className="
                                                            flex flex-col sm:flex-row sm:items-center
                                                            gap-1 sm:gap-3
                                                            bg-white
                                                            rounded-lg
                                                            shadow-sm
                                                            border border-border
                                                            px-2 sm:px-3 py-2
                                                            focus-within:ring-2 focus-within:ring-primary focus-within:ring-offset-2
                                                            transition
                                                            min-w-0 max-w-full overflow-hidden
                                                            cursor-pointer
                                                            hover:bg-gray-100 active:bg-gray-100
                                                        "
                                                        tabIndex={0}
                                                        role="button"
                                                        aria-label={`${name} 아이콘 이름 복사`}
                                                        onClick={() => handleCopy(name)}
                                                        onKeyDown={e => {
                                                            if (e.key === 'Enter' || e.key === ' ') {
                                                                e.preventDefault();
                                                                handleCopy(name);
                                                            }
                                                        }}
                                                    >
                                                        <span className="flex items-center gap-2 min-w-0 max-w-full overflow-hidden">
                                                            <span className="min-w-[32px] min-h-[32px] flex items-center justify-center text-primary flex-shrink-0">
                                                                {Icon && <Icon size={32} width={32} height={32} />}
                                                            </span>
                                                            <span className="font-mono text-base text-gray-900 select-all break-words max-w-full whitespace-pre-line min-w-0 overflow-hidden">
                                                                {name}
                                                            </span>
                                                            <button
                                                                type="button"
                                                                className="btn btn-ghost btn-square p-1 ml-1 flex-shrink-0"
                                                                title="Copy icon name"
                                                                tabIndex={-1}
                                                                onClick={e => {
                                                                    e.stopPropagation();
                                                                    handleCopy(name);
                                                                }}
                                                            >
                                                                {copiedName === name ? <Check size={16} className="text-green-600" /> : <Copy size={16} className="text-gray-500" />}
                                                            </button>
                                                        </span>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    ) : null
                                )}
                            </section>
                        ))
                    ) : (
                        <p className="text-center text-muted-foreground select-none">검색 결과가 없습니다.</p>
                    )}
                </div>

                {hasResults && (
                    <nav className="flex flex-wrap justify-center items-center gap-4 mt-6" aria-label="페이지 네비게이션">
                        <button
                            onClick={() => setCurrentPage(p => Math.max(p - 1, 1))}
                            disabled={currentPage === 1}
                            aria-label="이전 페이지"
                            className="btn btn-primary btn-sm disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            Prev
                        </button>
                        <span
                            className="text-primary font-medium select-none"
                            aria-live="polite"
                            aria-atomic="true"
                        >
                            {currentPage} / {totalPages}
                        </span>
                        <button
                            onClick={() => setCurrentPage(p => Math.min(p + 1, totalPages))}
                            disabled={currentPage === totalPages}
                            aria-label="다음 페이지"
                            className="btn btn-primary btn-sm disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            Next
                        </button>
                    </nav>
                )}
            </div>
        );
    }

    const rootElement = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElement);
    root.render(<App />);
    </script>
</body>
</html>